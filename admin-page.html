<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"
        integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous" />
    <link rel="stylesheet" href="style-admin-page.css">
    
</head>

<body>
    <header>
        <nav>
            <ul>
                <li><a href="home.html">Trang chủ</a></li>
                <li><a href="cart.html">Thanh toán</a></li>


            </ul>
        </nav>

    </header>

    <div class="container-fluid">


        <div class="aside">
            <ul>
                <li><a href="#">Sản phẩm</a></li>
                <li><a onclick="openModal(modalThemSanPham)" href="#">Thêm sản phẩm</a></li>


            </ul>
        </div>


        <div class="main-contain">
            <div class="modal" id="modal-them-san-pham" style="display: none;">
                <div class="form">
                    <div class="header">
                        <h1>Thêm sản phẩm</h1>
                        <span onclick="closeModal(modalThemSanPham)" id="close">&times;</span>
                    </div>
                    <div class="main-content">
                        <label for="hinhAnh">Hình ảnh sản phẩm</label>
                        <input required type="text" class="form-control" id="hinhAnh">
                        <div class="hien-thi-loi">
                            <p></p>
                        </div>

                        <label for="tenSanPham">Tên sản phẩm</label>
                        <input required type="text" class="form-control" id="tenSanPham">
                        <div class="hien-thi-loi">
                            <p></p>
                        </div>

                        <label for="giaGoc">Giá gốc sản phẩm</label>
                        <input required type="number" class="form-control" id="giaGoc">
                        <div class="hien-thi-loi">
                            <p></p>
                        </div>

                        <label for="phanTramGiamGia">Phần trăm giảm giá (0-100)</label>
                        <input required type="number" class="form-control" id="phanTramGiamGia">
                        <div class="hien-thi-loi">
                            <p></p>
                        </div>

                        <label for="loaiSanPham" style="width: fit-content;">Loại sản phẩm</label>
                        <select class="btn btn-primary" id="loaiSanPham">
                            <option value="manHinh" selected>Màn hình</option>
                            <option value="laptop">Laptop</option>
                        </select>
                    </div>

                    <div class="container-btn">
                        <button type="button" id="btn-them-san-pham">Thêm</button>
                        <button type="button" onclick="closeModal(modalThemSanPham)">Close</button>
                    </div>
                    <div class="hien-thi-loi">
                        <p></p>
                    </div>
                </div>
            </div>
            <h3>Sản phẩm</h3>
            <div id="danh-sach-san-pham">

            </div>

            <div class="modal" id="modal">
                <div class="form">
                    
                    <div class="header">
                        <h1>Sửa sản phẩm</h1>
                        <span onclick="closeModal(modal)" id="close-modal-sua">&times;</span>
                    </div>
                    <div class="main-content">
                        <div class="form-input-san-pham">
                            <label for="hinhAnh">Hình ảnh sản phẩm</label>
                            <input required type="text" class="form-control" id="hinhAnh-re">
                            <div class="hien-thi-loi">
                                <p></p>
                            </div>

                            <label for="tenSanPham">Tên sản phẩm</label>
                            <input required type="text" class="form-control" id="tenSanPham-re">
                            <div class="hien-thi-loi">
                                <p></p>
                            </div>

                            <label for="giaGoc">Giá gốc sản phẩm</label>
                            <input required type="number" class="form-control" id="giaGoc-re">
                            <div class="hien-thi-loi">
                                <p></p>
                            </div>

                            <label for="phanTramGiamGia">Phần trăm giảm giá (0-100)</label>
                            <input required type="number" class="form-control" id="phanTramGiamGia-re">
                            <div class="hien-thi-loi">
                                <p></p>
                            </div>

                            <label for="loaiSanPham" style="width: fit-content;">Loại sản phẩm</label>

                     
                            <select id="loaiSanPham-re">
                                <option value="manHinh">Màn hình</option>
                                <option value="laptop">Laptop</option>
                            </select>
                   
                        </div>
                    </div>

                    <div class="container-btn">
                        <button type="button" class="btn btn-success" id="btn-luu-san-pham">Lưu</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal"
                            onclick="closeModal(modal)">Close</button>
                    </div>
             
                </div>
            </div>

            <div class="modal" id="modal-xoa-san-pham">
                <div class="form">
                    <div class="header">
                        <h1>Xoá sản phẩm</h1>
                        <span onclick="closeModal(modalClose)" id="close-x">&times;</span>
                    </div>
                    <div class="main-content">
                        <div class="form-input-san-pham">
                            <h3>Bạn có muốn xoá sản phẩm không?</h3>
                        </div>
                    </div>

                    <div class="container-btn">
                        <button type="button" class="btn btn-success" id="btn-xoa-san-pham">Xoá</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal"
                            onclick="closeModal(modalClose)">Close</button>
                    </div>

                </div>
            </div>
        </div>
    </div>




</body>
<script src="javascript.js"></script>


<script>
    


    document.getElementById("btn-them-san-pham").addEventListener("click", function () {
        checkInputThemSanPham(event);
    });
    function themSanPham(sanPham) {
        var danhSach = danhSachSanPham();
        console.log(danhSach);
        danhSach.unshift(sanPham);
        localStorage.setItem(keyLocalSanPhamMoi, JSON.stringify(danhSach));
    }


    function checkInputThemSanPham(event) {

        var check = true;

        var nodeLoaiSanPham = document.getElementById('loaiSanPham');
        let nodeInput = document.querySelectorAll('#modal-them-san-pham input[required]');

        let nodeHienThiLoi = document.querySelectorAll('.hien-thi-loi p')


        for (let i = 0; i < nodeInput.length; i++) {
            if (nodeInput[i].value == '') {
                check = false;
                if (nodeInput[i].id == 'hinhAnh') {
                    var tenLoi = 'Hình ảnh';
                }
                if (nodeInput[i].id == 'tenSanPham') {
                    var tenLoi = 'Tên sản phẩm';
                }
                if (nodeInput[i].id == 'giaGoc') {
                    var tenLoi = 'Giá gốc sản phẩm';
                }
                if (nodeInput[i].id == 'phanTramGiamGia') {
                    var tenLoi = 'Phần trăm giảm giá';
                }

                nodeHienThiLoi[i].innerHTML = tenLoi + ' không được bỏ trống!';
            } else {
                if (nodeInput[i].id == 'hinhAnh') {
                    nodeHienThiLoi[i].innerHTML = '';
                    var hinhAnh = nodeInput[i].value;
                }
                if (nodeInput[i].id == 'tenSanPham') {
                    nodeHienThiLoi[i].innerHTML = '';
                    var tenSanPham = nodeInput[i].value;
                }
                if (nodeInput[i].id == 'giaGoc') {
                    if (nodeInput[i].value < 0) {
                        check = false;
                        nodeHienThiLoi[i].innerHTML = 'Giá gốc không thể âm!';

                    } else {
                        var giaGoc = nodeInput[i].value;
                    }
                }
                if (nodeInput[i].id == 'phanTramGiamGia') {
                    if (nodeInput[i].value < 0 || nodeInput[i].value > 100) {
                        check = false;
                        nodeHienThiLoi[i].innerHTML = 'Vui lòng nhập trong khoảng từ 0 - 100';

                    } else {
                        var phanTramGiamGia = nodeInput[i].value;
                    }
                }
            }

        }

        var loaiSanPham = nodeLoaiSanPham.value;
        console.log(loaiSanPham);

        console.log(nodeInput);
        if (check != false) {
            let sanpham = sanPham(hinhAnh, tenSanPham, giaGoc, phanTramGiamGia, loaiSanPham);
            console.log('sanpham');
            console.log(sanpham);
            themSanPham(sanpham);
        }
        hienThiSanPham();
    }
    var modalThemSanPham = document.getElementById('modal-them-san-pham')
    var modal = document.getElementById('modal');
    var modalClose = document.getElementById('modal-xoa-san-pham');


    hienThiSanPham();
    function hienThiSanPham() {
        let nodeHienThi = document.getElementById('danh-sach-san-pham');
        nodeHienThi.innerHTML = HTMLDanhSachSanPham();
    }

    function HTMLSanPham(sanPham) {
        let HTML = '';
        HTML = '   <div class="item">  ' +
            '                   <div class="anh-san-pham">  ' +
            '                       <img src="' + sanPham.hinhAnh + '"  ' +
            '                           alt="">  ' +
            '                   </div>  ' +
            '                   <div class="thong-tin-san-pham">  ' +
            '                       <div class="ten-san-pham">  ' +
            '                           <span>' + sanPham.tenSanPham + '</span>' +
            '                       </div>  ' +
            '                       <div class="gia-ban">  ' +
            '                           <span>' + formatTienTe(sanPham.giaBan()) + '</span>  ' +
            '                       </div>  ' +
            '                       <div class="gia-truoc-giam">  ' +
            '                           <span>' + sanPham.giaGoc + '</span>  ' +
            '                       </div>  ' +
            '                       <div class="phan-tram-giam-gia">  ' +
            '                           <span>' + sanPham.phanTramGiamGia + '</span>  ' +
            '                       </div>  ' +
            '                   </div>  ' +

            '                       <i onclick="suaSanPham(event,' + sanPham.id + ')" class="fas fa-cog btn-them-san-pham"></i>  ' +
            '                       <i onclick="xoaSanPham(' + sanPham.id + ')" class="fas fa-times btn-xoa-san-pham"></i>  ' +

            '              </div>  ';
        return HTML;
    }

    function suaSanPham(event, idSanPham) {
        var nodeModal = document.getElementById('modal');
        nodeModal.style.display = 'block';
        var nodeCha = event.target.parentElement;

        var hinhAnh = nodeCha.querySelector('.anh-san-pham img').getAttribute('src');

        var tenSanPham = nodeCha.querySelector('.thong-tin-san-pham .ten-san-pham span').innerText;
        console.log(tenSanPham);
        var giaGoc = nodeCha.querySelector('.thong-tin-san-pham .gia-truoc-giam span').innerText;
        var phanTramGiamGia = nodeCha.querySelector('.thong-tin-san-pham .phan-tram-giam-gia span').innerText;

        var danhSach = danhSachSanPham();
        var loaiSanPhamDefault = 'manHinh';
        for (var sanPham of danhSach){
            if (sanPham.id == idSanPham){
                loaiSanPhamDefault = sanPham.loaiSanPham;
            }
        }

        var nodeThayDoiHinhAnh = document.querySelector('#hinhAnh-re').setAttribute('value', hinhAnh);
        var nodeThayDoiHinhAnh = document.querySelector('#tenSanPham-re').setAttribute('value', tenSanPham);
        var nodeThayDoiHinhAnh = document.querySelector('#giaGoc-re').setAttribute('value', giaGoc);
        var nodeThayDoiHinhAnh = document.querySelector('#phanTramGiamGia-re').setAttribute('value', phanTramGiamGia);
        var nodeLuuSanPham = document.querySelector('#btn-luu-san-pham').setAttribute('onClick', 'luuSanPham(' + idSanPham + ')');
        var nodeLoaiSanPham = document.querySelectorAll('#loaiSanPham-re option');
        for (var option of nodeLoaiSanPham){
            if (option.getAttribute('value')==loaiSanPhamDefault){
                option.setAttribute('selected', 'true');
            }
        }

    }

    function xoaSanPham(idSanPham) {
        var danhSach = danhSachSanPham();
        var gioHang = danhSachGioHang();
        
        for (var i = 0; i < danhSach.length; i++) {
            if ( danhSach[i].id == idSanPham) {
                danhSach.splice(i,1);
                break;
            }
        }

        for (var i = 0; i < gioHang.length; i++) {
            if ( gioHang[i].id == idSanPham) {
                gioHang.splice(i,1);
                break;
            }
        }
        localStorage.setItem(keyLocalGioHang, JSON.stringify(gioHang));
        localStorage.setItem(keyLocalSanPhamMoi, JSON.stringify(danhSach));
        hienThiSanPham();
    }

    function luuSanPham(idSanPham) {
        var nodeModalSuaSanPham = document.getElementById('modal');
        var hinhAnh = nodeModalSuaSanPham.querySelector('#hinhAnh-re').value;
        var tenSanPham = nodeModalSuaSanPham.querySelector('#tenSanPham-re').value;
        var giaGoc = nodeModalSuaSanPham.querySelector('#giaGoc-re').value;
        var phanTramGiamGia = nodeModalSuaSanPham.querySelector('#phanTramGiamGia-re').value;
        var loaiSanPham = document.querySelector('#loaiSanPham-re').value;
        
        
        var danhSach = danhSachSanPham();
        for (var sanpham of danhSach) {
            if (sanpham.id == idSanPham) {
                sanpham.hinhAnh = hinhAnh;
                sanpham.tenSanPham = tenSanPham;
                sanpham.giaGoc = giaGoc;
                sanpham.phanTramGiamGia = phanTramGiamGia;
                sanpham.loaiSanPham = loaiSanPham;
                break;
            }
        }
        localStorage.setItem(keyLocalSanPhamMoi, JSON.stringify(danhSach));
        closeModal(modal);
        hienThiSanPham();
        location.reload();
    }

   



</script>

</html>